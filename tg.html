<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doggo Kiếm Khí</title>
<style>
  body {
    background:#111;
    color:#fff;
    font-family:sans-serif;
    text-align:center;
    overflow:hidden;
  }
  #login, #game { margin-top:20px; }
  #login input {
    padding:8px; border:none; border-radius:4px;
  }
  #login button {
    padding:8px 16px; background:#0f0; border:none;
    border-radius:4px; cursor:pointer;
  }
  canvas {
    background:#222;
    display:block;
    margin:20px auto;
    border:2px solid #fff;
  }
</style>
</head>
<body>

<div id="login">
  <h2>Đăng nhập để chơi</h2>
  <input type="text" id="username" placeholder="Tên người chơi">
  <button onclick="login()">Bắt đầu</button>
</div>

<div id="game" style="display:none;">
  <h2>Xin chào, <span id="playerName"></span>!</h2>
  <p>Điều khiển: ← → để di chuyển, ↑ để nhảy, hãy sủa theo để chú chó sủa:)))</p>
  <canvas id="canvas" width="800" height="400"></canvas>
  <p>Điểm: <span id="score">0</span></p>
</div>

<script>
let user = "";
function login(){
  user = document.getElementById("username").value.trim();
  if(user===""){ alert("Nhập tên trước!"); return; }
  document.getElementById("login").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("playerName").textContent=user;
  startGame();
}

function startGame(){
  const canvas=document.getElementById("canvas");
  const ctx=canvas.getContext("2d");

  // Nhân vật (chó)
  let x=100, y=300, vy=0, onGround=true, facing=1;
  let keys={}, score=0;

  // Quái vật (người que)
  let enemies = [];
  function spawnEnemy(){
    enemies.push({x:800, y:300, alive:true});
  }

  // Tiếng sủa (thay thế kiếm khí)
  let barks = [];

  // Vẽ chú chó
  function drawDog(x,y,facing){
    ctx.save();
    ctx.translate(x,y);
    ctx.scale(facing,1);
    ctx.lineWidth=3;
    ctx.strokeStyle="#8B4513455"; // Màu nâu cho chó
    ctx.fillStyle="#8B4513";

    // Thân
    ctx.beginPath();
    ctx.ellipse(0, 0, 20, 12, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // Đầu
    ctx.beginPath();
    ctx.arc(15, -10, 10, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // Mũi
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(22, -10, 2, 0, Math.PI * 2);
    ctx.fill();

    // Tai
    ctx.beginPath();
    ctx.moveTo(10, -20);
    ctx.lineTo(20, -25);
    ctx.lineTo(25, -15);
    ctx.fill();
    ctx.stroke();

    // Đuôi
    ctx.beginPath();
    ctx.moveTo(-20, 0);
    ctx.lineTo(-30, -10);
    ctx.stroke();

    // Chân
    ctx.beginPath();
    ctx.moveTo(-10, 10); ctx.lineTo(-15, 25);
    ctx.moveTo(10, 10); ctx.lineTo(5, 25);
    ctx.moveTo(-5, 10); ctx.lineTo(-10, 25);
    ctx.moveTo(15, 10); ctx.lineTo(10, 25);
    ctx.stroke();
    ctx.restore();
  }

  // Vẽ người que (quái vật)
  function drawEnemy(e){
    ctx.save();
    ctx.translate(e.x,e.y);
    ctx.lineWidth=3;
    ctx.strokeStyle="#fff";

    // đầu
    ctx.beginPath(); ctx.arc(0,-22,8,0,Math.PI*2); ctx.stroke();

    // thân
    ctx.beginPath(); ctx.moveTo(0,-14); ctx.lineTo(0,8); ctx.stroke();

    // tay
    ctx.beginPath(); ctx.moveTo(0,-6); ctx.lineTo(-12,2);
    ctx.moveTo(0,-6); ctx.lineTo(12,2); ctx.stroke();

    // chân
    ctx.beginPath(); ctx.moveTo(0,8); ctx.lineTo(12,24);
    ctx.moveTo(0,8); ctx.lineTo(-12,24); ctx.stroke();
    ctx.restore();
  }

  // Vẽ tiếng sủa
  function drawBark(s){
    ctx.save();
    ctx.fillStyle="white"; // Màu vàng cho tiếng sủa
    ctx.font = "bold 16px sans-serif";
    ctx.fillText("Ngu Như Chó!", s.x, s.y);
    ctx.restore();
  }

  // Sủa (Z)
  function bark(){
    barks.push({x:x+facing*30, y:y-10, dir:facing, speed:8, life:30}); // Thêm thuộc tính life để tiếng sủa biến mất
  }

  // Xử lý bàn phím
  document.addEventListener("keydown", e=>{
    keys[e.key]=true;
    if(e.key==="ArrowUp" && onGround){
      vy=-12; onGround=false;
    }
    if(e.key==="a"||e.key==="A"){ // Chữ 'z' cho tiếng sủa
      bark();
    }
  });
  document.addEventListener("keyup", e=>keys[e.key]=false);

  // Game loop
  function update(){
    // di chuyển
    if(keys["ArrowLeft"]){x-=5; facing=-1;}
    if(keys["ArrowRight"]){x+=5; facing=1;}

    // trọng lực
    y+=vy;
    vy+=0.8;
    if(y>=300){y=300; vy=0; onGround=true;}

    // di chuyển quái
    enemies.forEach(e=>{
      if(e.alive) e.x -= 3;
    });

    // di chuyển tiếng sủa
    barks.forEach(s=>{
      s.x += s.dir*s.speed;
      s.life--;
    });

    // kiểm tra va chạm
    enemies.forEach(e=>{
      barks.forEach(s=>{
        if(e.alive && Math.abs(s.x-e.x)<30 && Math.abs(s.y-e.y)<30){ // Điều chỉnh phạm vi va chạm cho tiếng sủa
          e.alive=false;
          score+=10;
          document.getElementById("score").textContent=score;
        }
      });
    });

    // lọc vật thể
    enemies=enemies.filter(e=>e.x>-50 && e.alive); // Lọc quái đã chết
    barks=barks.filter(s=>s.x>0 && s.x<800 && s.life > 0); // Lọc tiếng sủa hết hạn

    // sinh quái ngẫu nhiên
    if(Math.random()<0.02){
      spawnEnemy();
    }

    // vẽ
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawDog(x,y,facing);
    enemies.forEach(e=>{if(e.alive) drawEnemy(e);});
    barks.forEach(drawBark);

    requestAnimationFrame(update);
  }

  update();
}
</script>

</body>
</html>